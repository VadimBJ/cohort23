## REST API

### REST

* `API` - application programming interface - набор функций, для взаимодействия с чем-либо

* Набор правил и рекомендаций

* Подразумевает полноценное использование HTTP-методов
  * POST - для добавления (данные передаем в теле запроса в формате JSON)
  * GET - для получения
  * DELETE - для удаления
  * PUT - для обновления (данные передаем в теле запроса в формате JSON)
* При добавлении чего-либо в ответ возвращаем то же самое, что добавили
* Подразумевает полноценное использование статусов
* Правильное именование endpoints

```
Именуем их так, будто они - папки с файлами и подпапками (ресурсо-ориентированный подход)

/users - все пользователи

/users/1 - пользователь с id = 1

/users/1/articles - все статьи пользователя с id = 1
```

* Хороший стиль - начинать свои endpoints c префикса `api`
* Хороший стиль - использовать параметры запроса `?key1=value1&key2=value2..` для фильтрации и поиска

### Задачи

- Добавить событие
- Получить список всех пользователей
- Получить список всех событий
- Зарегистрировать пользователя на событие
- Посмотреть всех участников определенного события
- Посмотреть все события определенного пользователя

### Важные заметки

#### Dto - Data Transfer Object

* Зачастую возникают ситуации, когда наш API отличается от моделей (какие-то поля отсутствуют, какие-то присутствует, какие-то выглядят по другому и т.д.)
* Для решения этой проблемы мы на уровне контроллеров и сервисов не используем модели, а используем Dto
* Dto - это подход, при котором мы создаем дополнительные классы, отвечающие требованиям API

#### Аннотации в контроллерах

* `@ResponseBody` - показывает, что нужно вернуть данные в теле ответа в формате JSON
* `@RequestBody` - показывает, что нужно вытащить данные из тела запроса в формате JSON
* `@RequestMapping` - просто говорит, что данный метод или контроллер должен срабатывать на нужный URL
* `@RestController` - эта аннотация позволяет избавиться от написания `@ResponseBody` для каждого
* `@PathVariable` - эта аннотация позволяет вытащить часть URL, который заключен в фигурные скобки. "Переменная пути"
* `@RequestParam` - эта аннотация позволяет вытащить параметр запроса из URL (например, `?year=10`)

#### Ссылочные в моделях 

* Не используем примитивные типы в моделях
* Потому что ссылочные типы позволяют хранить значение null
* В базе какой-то столбец может быть null и в программе тоже должно быть null
* Например, кто-то не захотел указывать свой возраст, тогда его age = null
* Не логично, чтобы возраст был 0

### HTTP-запрос

* Чтобы сервер понимал, в каком формате мы передаем ему данные, мы отправляем их вместе с заголовком:
  * Content-Type: application/json
* Чтобы клиент понимал, как отработал запрос, сервер отправляет ему в ответе статус (целое число, идентифицирующее ситуацию)
  * 200 - все хорошо
  * 201 - создано
  * 404 - если не найден соответствующий URL (endpoint)
  * 500 - на сервере произошла ошибка
  * 403 - запрещено (у пользователя нет прав)
  * 401 - пользователь не авторизован
  * 405 - не поддерживается метод
  * и так далее

### Работа в IntelliJ IDEA

* Если хотите посмотреть использование или объявление чего-либо, нажимайте Ctrl + B (при этом курсор должен стоять на том, что вы хотите) либо Ctrl + ЛКМ
* Если хотите посмотреть реализацию метода через интерфейс - Ctrl + Alt + B
* Между вкладками я переключаюсь с помощью зажатия Ctrl и нажатия Tab
* Если нужно быстро переключиться между двумя вкладками просто нажимаем быстро

### Интеграционный тест

* Тяжеловесный тест, который полностью поднимает все приложение со всеми конфигурациями
* `@SpringBootTest` - аннотация, которая говорит, что для этого теста нужно поднять конфигурацию Spring Boot
* `@AutoConfigureMockMvc` - аннотация, которая включает конфигурацию `MockMvc`
* `MockMvc` - класс, который позволяет отправлять запросы на ваш сервер и получать ответы

### Еще дополнительные замечания

* `@EqualsAndHashCode(exclude = "events")` - убираем поле `events` при генерации `equals()` и `hashCode()`
* `Optional<T>` - встроенный в Java класс, который явно позволяет показать, что может вернутся `null`

### Глобальный порядок операций

1. Описать задачу (см. README.md)
2. Описать в API-слое запрос вместе с документацией
3. Реализовать метод в Controllers, Services, Repositories и т.д.
4. Предусмотреть ошибочные ситуации
5. Проверить через requests.http
6. Написать тест и проверить тест для разных случаев
7. Проверить через Swagger