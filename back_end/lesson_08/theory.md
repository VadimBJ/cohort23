# Lesson 08 - 21.07.2023

## 01. REST

* `API` - application programming interface - набор функций, для взаимодействия с чем-либо

* Набор правил и рекомендаций

* Подразумевает полноценное использование HTTP-методов
  * POST - для добавления (данные передаем в теле запроса в формате JSON)
  * GET - для получения
* При добавлении чего-либо в ответ возвращаем то же самое, что добавили
* Подразумевает полноценное использование статусов

* Хороший стиль - начинать свои endpoints c префикса `api`

### Задачи

- Добавить событие
- Получить список всех пользователей
- Получить список всех событий
- Зарегистрировать пользователя на событие
- Посмотреть всех участников определенного события
- Посмотреть все события определенного пользователя

### Важные заметки

## 02. Dto - Data Transfer Object

* Зачастую возникают ситуации, когда наш API отличается от моделей (какие-то поля отсутствуют, какие-то присутствует, какие-то выглядят по другому и т.д.)
* Для решения этой проблемы мы на уровне контроллеров и сервисов не используем модели, а используем Dto
* Dto - это подход, при котором мы создаем дополнительные классы, отвечающие требованиям API

## 03. Аннотации в контроллерах

* `@ResponseBody` - показывает, что нужно вернуть данные в теле ответа в формате JSON
* `@RequestBody` - показывает, что нужно вытащить данные из тела запроса в формате JSON
* `@RequestMapping` - просто говорит, что данный метод или контроллер должен срабатывать на нужный URL
* `@RestController` - эта аннотация позволяет избавиться от написания `@ResponseBody` для каждого

## 04. Ссылочные в моделях 

* Не используем примитивные типы в моделях
* Потому что ссылочные типы позволяют хранить значение null
* В базе какой-то столбец может быть null и в программе тоже должно быть null
* Например, кто-то не захотел указывать свой возраст, тогда его age = null
* Не логично, чтобы возраст был 0

## 05. HTTP-запрос

* Чтобы сервер понимал, в каком формате мы передаем ему данные, мы отправляем их вместе с заголовком:
  * Content-Type: application/json
* Чтобы клиент понимал, как отработал запрос, сервер отправляет ему в ответе статус (целое число, идентифицирующее ситуацию)
  * 200 - все хорошо
  * 201 - создано
  * 404 - если не найден соответствующий URL (endpoint)
  * 500 - на сервере произошла ошибка
  * 403 - запрещено (у пользователя нет прав)
  * 401 - пользователь не авторизован
  * 405 - не поддерживается метод
  * и так далее

## 06. Работа в IntelliJ IDEA

* Если хотите посмотреть использование или объявление чего-либо, нажимайте Ctrl + B (при этом курсор должен стоять на том, что вы хотите) либо Ctrl + ЛКМ
* Если хотите посмотреть реализацию метода через интерфейс - Ctrl + Alt + B
* Между вкладками я переключаюсь с помощью зажатия Ctrl и нажатия Tab
* Если нужно быстро переключиться между двумя вкладками просто нажимаем быстро

## 07. Интеграционный тест

* Тяжеловесный тест, который полностью поднимает все приложение со всеми конфигурациями
* `@SpringBootTest` - аннотация, которая говорит, что для этого теста нужно поднять конфигурацию Spring Boot
* `@AutoConfigureMockMvc` - аннотация, которая включает конфигурацию `MockMvc`
* `MockMvc` - класс, который позволяет отправлять запросы на ваш сервер и получать ответы

![image](https://raw.githubusercontent.com/ait-tr/cohort23/main/back_end/lesson_08/img/1.png)